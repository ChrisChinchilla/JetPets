<?php

/**
 * @file
 * Short file description here.
 *
 * Long description here.
 */

/**
 * Implements hook_menu().
 */
function jpgf_menu() {

  $items['jpgf/import'] = array(
    'title' => 'Import GF JSON',
    'page callback' => 'jpgf_page',
    'access arguments' => array('access content'),
    'type' => MENU_NORMAL_ITEM,
    );

  return $items;
}

/**
 * Implements hook_help().
 */
function jpgf_help($path, $arg) {

  switch ($path) {
    case 'admin/help#jpgf':

      // Return a line-break version of the README.
    $readme = file_get_contents(drupal_get_path('module', 'jpgf') . '/README.txt');
    return nl2br($readme);
  }
}

/**
 * Page example callback, referenced in hook_menu().
 *
 * Description of what the page displays.
 * Second line of the description.
 *
 * @return string
 *   The content of the page.
 */
function jpgf_page() {

  process_json();
  //return $output;

}

function process_json() {
  $context = stream_context_create(array(
   'http' => array(
    'method' => "GET",
    'header' => 'Authorization: Bearer 173709a1f841645f8f1a0e0991f37056'
    )
   ));

  $response =  file_get_contents('https://api.getfeedback.com/surveys/29880/responses', false, $context);

// Check for errors
  if($response === FALSE){
    // die(curl_error($ch));
  }

  else {

// Decode the response

    $responseData = json_decode($response, TRUE);
    $returnData = array();
    foreach ($responseData['active_models'] as $value) {
     var_dump($value);
   }
 }
}

/**
 * Implements hook_page_build().
 *
 * Add JavaScript and CSS code to every page.
 */
function jpgf_page_build() {

  drupal_add_js(drupal_get_path('module', 'jpgf') . '/js/jpgf.js');
  drupal_add_css(drupal_get_path('module', 'jpgf') . '/css/jpgf.css');

}
